# Gas Report

## 怎么更方便的测试自己程序的gas消耗？

写些程序来测试我们的操作将消耗多少gas费用。

## 本地调试怎么计算gas消费？

---

- gas reporter

`yarn add -D hardhat-gas-reporter`

- 添加到hardhat.config.ts

`import "hardhat-gas-reporter"`

- 在hardhat配置中开启gas-reporter

```json
const config: Config = {
  ...,
  networks: {
    hardhat: {
      chainId: 31337
    },
    ...
  },
  gasReporter: {
    enabled: true
  }
};
```

## 测试操作gas消耗

---

```json
pragma solidity ^0.8.24;

contract TestGas {
	uint a;
	uint b;
	uint c;
	
	function test1() public {
		a++;
	}

	function test2() public {
		a++;
		b++;
	}
	
	function test3() public {
		a++;
		b++;
		c++;
	}
	
	function test4() public {
		c = a + b;
	}
	
	function test5() public {
		test4();
		b = a + c;
	}
	
}
```

## Test Gas

---

```json
const TG = await ethers.getContractFactory("TestGas");
const tg = await TG.deploy();
await tg.waitForDeployment();

for(let i = 0; i < 10; ++i){
	await tg.test1();
	await tg.test2();
	await tg.test3();
	await tg.test4();
	await tg.test5();
}
```

和测试代码一样，运行

`npx hardhat test`

## 核心要点

---

- 注意你的每个操作，他们都会有gas消耗   
- 矿工会打包，不会一半成功一半失败，只会失败
- 在一些编程语言里面，你可能很爱做copy操作，js（deepClone），在solidity里面别这么做，这种开销非常大。
- 转换一下你的开发思路，你在solidity里面做的所有操作都是真实在花钱的，以前你可能觉得内存、cpu够用就吃满，但在solidity里别这样想。【array举例】immutation