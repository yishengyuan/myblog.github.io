# 连接小狐狸钱包
![[Pasted image 20251022204341.png]]

## Webpack Config

---

前端工程化使用的打包工具：webpack

https://webpack.js.org/

rollup、parcel、vercel、vite、gulp…（用rust、go写的打包工具…Rspack、esbuild）

其它部分都会live coding，除了这部分内容，直接copy一下，前端应用开发使用的打包工具有很多，webpack生态目前仍然是最大的，其它封装更成熟的应用开发框架比如next.js、angular这些框架会自己集成应用的基本配置能力在框架内，各种打包工具也基本都会兼容支持webpack的配置项，这里不做过多的介绍。

根目录下创建文件 webpack.config.js 
```bash
const dotenv = require("dotenv");
dotenv.config();

const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
const webpack = require("webpack");

module.exports = {
    entry: "./src/index.ts", // bundle"s entry point
    output: {
        path: path.resolve(__dirname, "dist"), // output directory
        filename: "[name].js", // name of the generated bundle
    },
    resolve: {
        extensions: [".js", ".ts", ".json"],
    },

    mode: "development",

    module: {
        rules: [
            {
                test: /\.ts$/,
                loader: "ts-loader",
                exclude: /node_modules/,
            },

            {
                test: /\.css$/i,
                use: ["style-loader", "css-loader"],
            },
        ],
    },
    plugins: [
        new HtmlWebpackPlugin({
            template: "./src/index.html",
            inject: "body",
        }),
        new webpack.DefinePlugin({
            'process.env.CONTRACT_ADDRESS': JSON.stringify(process.env.CONTRACT_ADDRESS),
            'process.env.DEBUG': JSON.stringify(process.env.DEBUG),
        }),
    ],

    devServer: {
        historyApiFallback: true,
        port:8080,
        hot:true
    }
};
```

创建文件 src/index.ts 
 src/index.html
## 添加一些Webpack依赖

---

```bash
yarn add -D webpack webpack-cli ts-loader html-webpack-plugin dotenv webpack-dev-server
```

## tsconfig.json

---

```json
{
    "compilerOptions": {
        "resolveJsonModule": true,
        "esModuleInterop": true
    }
}
```

## Metamask交互

---

- 初始化合约
- 调用合约方法

## 完整代码

npm install dotenv-webpack --save-dev


.env   必须安装上面插件 否则读不到
```
CONTRACT_ADDRESS=0xe7f1725e7734ce288f8367e1bb143e90bb3f0512
```


index.ts


```tsx
import { ethers } from "ethers";

function getEth() {
    // @ts-ignore
    const eth = window.ethereum;
    if (!eth) {
        throw new Error("No ethereum provider found");
    }
    return eth;
}

async function requestAccess() {
    const eth = getEth();
    const result = await eth.request({ method: "eth_requestAccounts" }) as string[];
    return result && result.length > 0;
}

async function hasSigners(){
    const metamask = getEth();
    const signers = await metamask.request({ method: "eth_accounts" }) as string[];
    return signers.length > 0;
}

async function getContract(){
    // 1. 地址
    // 2. 方法名
    // 3. provider

    if (!await hasSigners() && !await requestAccess()) {
        throw new Error("No ethereum provider found");
    }
    const provider = new ethers.BrowserProvider(getEth());
    const address = process.env.CONTRACT_ADDRESS;
    const contract = new ethers.Contract(
        address,
        [
            "function hello() pure public returns (string memory)"
        ],
        provider
    )
    document.body.innerHTML = await contract.hello();
}

async function main(){
    await getContract();
}

main();
```

`npx webpack server —open`

## 一些问题

---

- 里面发生了什么?
    - 告诉程序要找到哪个合约
    - 合约接口是什么
    - provider
- 有一个永远存在的程序在世界上
- 部署过后能不能升级？
    - 如果要升级怎么办？(会花一些时间单独讲)

## Gas Fee??

---

1. 不消耗gas【没有任何状态的改变】
2. 消耗gas，留个悬念，后面课程将知道怎么看到每个操作消耗多少gas

## Webpack Supply

---

对webpack在工程化上的配置内容做补充

## 新的工具

---

```jsx
yarn add -D webpack-merge
```

## 拆分一下webpack.config.js

- webpack.common.js

```jsx
const dotenv = require("dotenv");
dotenv.config();

const path = require("path");
const HtmlWebpackPlugin = require("html-webpack-plugin");
module.exports = {
    entry: "./src/index.ts", // bundle"s entry point
    output: {
        path: path.resolve(__dirname, "dist"), // output directory
        filename: "[name].js", // name of the generated bundle
    },
    resolve: {
        extensions: [".js", ".ts", ".json"],
    },

    plugins: [
        new HtmlWebpackPlugin({
            template: "./src/index.html",
            inject: "body",
        }),
    ],

    module: {
        rules: [
            {
                test: /\.ts$/,
                loader: "ts-loader",
                exclude: /node_modules/,
            },

            {
                test: /\.css$/i,
                use: ["style-loader", "css-loader"],
            },
        ],
    },
}
```

- webpack.dev.js

```jsx
const webpack = require("webpack");
const { merge } = require("webpack-merge");
const baseConfig = require("./webpack.common.js");

module.exports = merge(baseConfig, {
    mode: "development",
 

    devServer: {
        historyApiFallback: true,
        port: 8080,
        hot: true,
    }
});
```

- webpack.prod.js

```jsx

const webpack = require("webpack");
const { merge } = require("webpack-merge");
const baseConfig = require("./webpack.common.js");

module.exports = merge(baseConfig, {
    mode: "production"
  
})
```

## package.json

---

```json
{
  "name": "firstcontract",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  
  /** 添加这段scripts **/
  "scripts": {
    "dev": "webpack serve --config webpack.dev.js",
    "build": "webpack --config webpack.prod.js"
  },
  
  "devDependencies": {
    ...
  },
  "dependencies": {
    ...
  }
}

```

## 执行

```
npm run build 
npm run dev
```