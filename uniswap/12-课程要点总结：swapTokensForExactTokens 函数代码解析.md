课程要点总结：`swapTokensForExactTokens` 函数代码解析

1. **函数目的**  
   - `swapTokensForExactTokens` 函数用于执行代币交换操作，根据指定的输出数量计算所需的最小输入量。
   - 例如，若用户希望获得 1 WETH，但最多愿意花费 3000 DAI，则调用此函数以确保在支出不超过上限的前提下完成交换。若获取 1 WETH 需要的 DAI 超过 3000，则函数将中止。

2. **调用 `getAmountsIn` 函数**  
   - 函数首先调用 `getAmountsIn`，计算满足指定输出量（`amountOut`）所需的最小输入量。
   - **数组内容**：
     - `amounts[0]`：所需的最小输入量。
     - `amounts[-1]`：用户期望得到的确切输出量。
     - 其他元素为中间交换的代币数量。
   - **输入检查**：函数检查 `amounts[0]` 是否小于或等于用户设定的 `amountInMax`（允许的最大输入量），否则交易失败。

3. **转移初始输入代币**  
   - 从 `path[0]`（输入代币地址）向第一个交易对合约（`pairContract`）转移输入代币数量 `amounts[0]`。
   - `pairContract` 地址通过 `pairFor` 函数计算，使用 `path[0]` 和 `path[1]` 这两个代币地址生成。
   - 此步骤在调用 `swap` 函数前完成，确保第一个交易对合约中有足够的输入代币。

4. **调用内部 `swap` 函数**  
   - `swap` 函数在 `for` 循环中遍历每个交易对合约，执行交换操作：
     - **最后一次交换**：将输出代币发送至指定的接收地址（`to`）。
     - **中间交换**：将输出代币发送至下一个交易对合约，作为下一次交换的输入。

5. **总结**  
   - `swapTokensForExactTokens` 通过精确的路径和数量控制，确保了用户得到指定的输出代币，同时避免了过量支出。
   - `getAmountsIn` 函数在交换前计算出每次交换所需的输入量，实现了在多跳路径上的代币交换。