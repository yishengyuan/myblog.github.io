### Uniswap V2课程：股份铸造公式推导与应用

#### 要点总结

1. **变量定义**：

   - T：当前总股份数（Total Shares）。
   - S：需要铸造的股份数（Shares to Mint）。
   - L_0：用户存入前的流动池总价值（Value of Pool Before Deposit）。
   - L_1：用户存入后的流动池总价值（Value of Pool After Deposit）。

2. **流动池价值的定义**：

   - 流动池价值可以定义为池中代币的总余额。
   - 对于 Uniswap V2 Pair 合约，价值计算可以采用多种方式，但在本次推导中，默认将其视为池中锁定代币的余额。

3. **股份分配的基本原则**：

   - 用户新增股份的数量与流动池价值的增加成比例。
   - 增加的比例可以用 L1/L0表示，表示流动池价值从 L0增长到 L_1 的增幅。

4. **公式推导**：

   - 初始设置：
     $$
     \frac{L_1}{L_0} = \frac{T + S}{T}
     $$
     

     - 左边表示池价值的增长比例。
     - 右边表示股份增长的比例。

   - 特例说明

     ：

     - 当 T=0T = 0 时（无流动性提供者），用户存入多少代币，就铸造相同数量的股份。

   - 公式化简

     ：

     - 通过代数运算求解 SS：

     - $$
       S = T \times \frac{L_1 - L_0}{L_0}
       $$

     - 

     - 公式解释：

       - SS：新增股份。
       - TT：总股份。
       - L1−L0：流动池新增价值。
       - L0：存入前的流动池价值。

5. **公式的应用示例**：

   - 假设条件

     ：

     - 当前总股份 T=1,000T = 1,000。
     - 存入前的流动池价值 L0=1,100L_0 = 1,100。
     - 用户存入代币后，流动池价值变为 L1=1,210L_1 = 1,210。

   - **计算新增股份**：

   - $$
     S = 1,000 \times \frac{1,210 - 1,100}{1,100} = 100
     $$

   - 结果

     ：

     - 新用户获得 100 股份。
     - 总股份更新为 T + S = 1,100。

6. **公式的适用场景**：

   - 适用于动态调整股份的场景，例如流动性提供或提取过程中，流动池价值发生变化时。
   - 确保每位流动性提供者的股份分配与其贡献的比例一致。

通过本节内容，学员可掌握股份分配公式的推导与实际应用，为理解 Uniswap V2 的流动性机制打下扎实基础。