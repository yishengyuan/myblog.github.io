### Uniswap V2 移除流动性函数 `removeLiquidity`

1. **函数位置与调用**

   - `removeLiquidity` 函数位于 Uniswap V2 路由器合约（`UniswapV2Router02`）中，属于 `UniswapV2Periphery` 仓库的一部分。
   - 用户调用该函数以从交易对合约中移除流动性，传入的参数包括交易对的两个代币（例如 WETH 和 DAI）。
   - 注意：代币顺序不影响调用结果，可以先传入 DAI 再传入 WETH，或者先传入 WETH 再传入 DAI，都会调用同一个交易对合约。

2. **函数输入参数**

   - `tokenA` 和 `tokenB`：指定的交易对代币。
   - `liquidity`：用户要销毁的流动性池份额数量。
   - `amountAMin` 和 `amountBMin`：用户期望通过销毁指定流动性池份额获得的最小代币数量。
   - `to`：指定接收代币的地址。
   - `deadline`：此函数调用的有效时间戳，超时会导致调用失败。

3. **函数输出参数**

   - `amountA` 和 `amountB`：实际提取的代币数量，这些代币将发送到指定的 `to` 地址。

4. **计算交易对合约地址**

   - 路由器合约通过 `pairFor` 函数计算交易对合约的地址。该地址通过 `create2` 创建。
   - 如果交易对合约不存在，调用 `transferFrom` 时会失败，这意味着我们可以假设交易对合约已存在。如果合约未部署，则调用会失败。

5. **转移流动性池份额**

   - 当调用 `removeLiquidity` 时，首先会将流动性池份额（ERC20）从用户账户转移到交易对合约。
   - 为了让路由器合约能调用 `transferFrom`，用户需要先批准路由器合约能支配这些流动性池份额。

6. **调用 `burn` 函数**

   - 接着，路由器合约会调用交易对合约的 `burn` 函数，销毁流动性池份额，并将对应的代币返回给用户。

7. **`burn` 函数返回的代币数量**

   - `burn` 函数返回两个输出：`amount0` 和 `amount1`，分别表示返回的两个代币的数量。

   - 由于 

     ```
     removeLiquidity
     ```

      中传入的代币顺序可能不同，因此我们需要根据代币的顺序来确定 

     ```
     amount0
     ```

      和 

     ```
     amount1
     ```

      对应的代币。具体方法是：

     - 对 `tokenA` 和 `tokenB` 进行排序，先排的代币为 `token0`，后排的为 `token1`。
     - 如果 `tokenA` 是 `token0`，则 `amountA` 对应 `amount0`，`amountB` 对应 `amount1`，反之亦然。

8. **检查最小提取量**

   - 在返回代币之前，代码会检查实际提取的代币数量是否大于等于用户预期的最小数量。如果未达到，函数调用会失败。

9. **总结**

   - `removeLiquidity` 函数通过将流动性池份额转移到交易对合约并调用 `burn` 函数销毁份额，最终将相应数量的代币返还给用户。