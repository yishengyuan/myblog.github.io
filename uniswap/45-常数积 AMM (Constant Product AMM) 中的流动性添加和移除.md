### 常数积 AMM (Constant Product AMM) 中的流动性添加和移除

1. **流动性添加规则**
   - 流动性添加时，添加的 token X 和 token Y 的数量必须遵循一个规则：添加流动性后的价格必须与添加之前的价格相等。
   - 例如，在添加流动性之前，价格为 1.4，添加正确数量的 token X 和 token Y 后，价格依然保持为 1.4。
   - 通过绘制从原点到当前价格的直线，可以直观地看到添加流动性时，所有有效的 token X 和 token Y 数量必须位于这条直线上。只有在这条线上，价格才能保持一致。
2. **流动性移除规则**
   - 从常数积 AMM 中移除流动性时，移除流动性后的价格必须与移除之前的价格相等。
   - 假设当前 AMM 由紫色曲线表示，移除流动性后价格仍然需要保持为 1.4，移除流动性后，token X 和 token Y 的余额必须位于一条绿色线上的点上。
   - 通过减少流动性，紫色曲线会逐渐接近蓝色曲线。在每个点上，价格等于 1.4 的点将正好位于绿色线上。
3. **流动性移除时如何保持价格不变**
   - 移除流动性时，要确保价格不变，所需从池中移除的 token X 和 token Y 数量应该是位于绿色线上的点。
   - 例如，当流动性逐渐减少时，价格依然保持在 1.4，直到完全移除流动性，价格仍然在绿色线上保持不变。

### 关键点总结

- **添加流动性时**：必须确保新添加的 token X 和 token Y 的数量使得价格保持不变，符合常数积 AMM 的规则。
- **移除流动性时**：同样需要遵循价格保持不变的规则，移除的 token 数量应保证 AMM 中的价格不发生波动。