### Uniswap V2 流动性添加课程要点总结

1. **引入**

   - 在向流动池添加流动性时，涉及的主要问题是如何根据已经存在的 Token 数量来计算添加多少 Token。
   - 设定添加的 Token 数量为 DX（X Token）和 DY（Y Token）。

2. **约束条件**

   - 假设我们已经有了 X Token 的数量 x0 和 Y Token 的数量 y0，添加流动性时，添加的 Token 数量 DX 和 DY 必须满足一定的关系。

   - 关系式：添加的 Y Token 数量 DY 和添加的 X Token 数量 DX 必须保持与现有的 X Token 和 Y Token 数量相同的比例。即：

     **y0 / x0 = DY / DX**

3. **推导过程**

   - 回顾之前的内容，流动性添加后池子的价格必须与添加流动性前的价格一致。
   - 一种直观的记忆方式是：从原点到当前的 Token 数量画一条直线，添加流动性后新的 Token 数量必须位于这条直线上。
   - 比如，假设开始时有 x0 个 X Token 和 y0 个 Y Token，那么添加流动性后的 Token 数量仍然需要在这条直线上。

4. **价格关系**

   - 在常数乘积 AMM（自动化做市商）模型中，价格等于 Y Token 的数量除以 X Token 的数量，即：
     - **价格 = y0 / x0（流动性添加前）**

5. **流动性添加后的价格**

   - 流动性添加后，新的价格可以用以下公式表示：
     - **价格（添加流动性后） = (y0 + DY) / (x0 + DX)**

6. **等式推导**

   - 流动性添加后价格与添加前价格相等，即：
     - **(y0 + DY) / (x0 + DX) = y0 / x0**
   - 将该等式简化后：
     - 左侧：x0 * y0 + x0 * DY
     - 右侧：y0 * x0 + y0 * DX
   - 取消掉相同的 x0 * y0 和 y0 * x0 后，得到：
     - **x0 \* DY = y0 \* DX**
   - 最终，得到的关系式为：
     - **DY / DX = y0 / x0**

7. **结论**

   - 在添加流动性时，添加的 Y Token 数量 DY 和 X Token 数量 DX 必须满足：
     - **DY / DX = y0 / x0**
   - 这意味着，添加的 Token 数量必须遵循与池中现有 Token 数量的比例。