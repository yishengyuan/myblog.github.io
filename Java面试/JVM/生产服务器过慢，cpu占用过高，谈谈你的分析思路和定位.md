## **一、明确问题**

1. **现象**：生产服务器“过慢”，CPU占用过高。
    
2. **目标**：找到瓶颈、定位原因、提出优化方案。
    
3. **确认范围**：是单台机器问题还是集群问题？是瞬时高峰还是持续高负载？
## **二、初步信息收集**

1. **监控数据**
    
    - CPU、内存、磁盘IO、网络IO使用情况
        
    - 系统负载（`top`, `htop`, `vmstat`, `iostat`）
        
    - 应用层监控（GC、线程数、TPS、响应时间）
        
    - 数据库慢查询、锁等待
        
2. **日志**
    
    - 应用日志：报错、异常、请求耗时
        
    - 系统日志：`/var/log/messages`, `dmesg`
        
3. **历史变化**
    
    - 最近是否有新版本部署
        
    - 最近是否流量增长或数据量增加
## **三、分析定位思路**

### 1️⃣ 系统层面

- CPU占用高 → 是**用户态**占用高还是**系统态**占用高？
    
    - `top`看%us、%sy、%wa（用户/系统/等待IO）
        
    - 如果系统态占用高 → 可能是IO密集或频繁系统调用
        
- 内存不足 → 是否发生频繁交换（swap）？
    
    - `free -m` / `vmstat`
        
- 磁盘IO瓶颈 → IO等待高（%wa高）
    
    - `iostat -x 1`
        
- 网络瓶颈 → 网络IO异常
### 2️⃣ 应用层面

- Java/C++/Python应用 → 检查线程、GC、锁
    
- Java示例：
    
    - **线程数**异常 → `jstack` 分析线程阻塞/死锁
        
    - **GC频繁** → `jstat`, `GC日志` 查看 Full GC/Minor GC
        
    - **热点方法** → `async-profiler` / `YourKit` 分析 CPU 火焰图
        
- 检查是否存在**无限循环或高频计算**
### 3️⃣ 数据库层面

- SQL慢查询或全表扫描
    
- 连接池耗尽
    
- 锁等待导致应用线程阻塞
    
- 典型工具：`SHOW PROCESSLIST`（MySQL）、`pg_stat_activity`（Postgres）
### 4️⃣ 缓存与队列

- 缓存击穿 → 请求直接打到数据库
    
- 队列堆积 → 消费慢，应用阻塞
### 5️⃣ 代码层面

- 检查最近代码变更或高耗时逻辑
    
- 高并发场景下的锁/同步问题
## **四、定位方法**

1. **快速定位CPU热点**
    
    - Linux：`top`, `htop`, `pidstat`, `perf top`
        
    - Java：`jstack`, `jmap`, `async-profiler`
        
2. **锁/线程阻塞分析**
    
    - `jstack` + `grep BLOCKED`
        
3. **数据库慢查询分析**
    
    - 开启慢查询日志
        
4. **日志排查**
    
    - 查看异常、请求耗时
## **五、总结分析思路**

1. 收集信息 → 监控、日志、历史变化
    
2. 系统层排查 → CPU/内存/IO/网络
    
3. 应用层排查 → 线程、GC、热点方法
    
4. 数据库层排查 → 慢查询、锁、连接池
    
5. 缓存/队列排查 → 减少数据库压力
    
6. 代码层排查 → 高耗时/锁/死循环
    

---

✅ **回答面试时的技巧**

- 先表明你有系统化分析思路
    
- 然后逐层排查
    
- 最后提出优化建议（如CPU热点优化、SQL优化、增加缓存、扩容等）
