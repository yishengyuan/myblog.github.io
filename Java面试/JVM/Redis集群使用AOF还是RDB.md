在 **Redis 集群（Redis Cluster）中，一般推荐同时开启 RDB + AOF，但以 RDB 为主，以 AOF 为辅**。  
大厂（美团、滴滴、阿里、字节）线上几乎都是这样的组合。

Redis 6.0 以后默认是：
```
appendonly yes
appendfsync everysec

```

并且开启 **AOF + RDB 混合**（AOF 重写时把 RDB 快照写入 AOF 头部）。

👉 **混合模式 = 恢复更快 + 文件更小 + 数据更安全。**

# 📌 为什么 Redis 集群不能只用 AOF？

### ❌ 原因 1：AOF 太慢，恢复速度比 RDB 慢得多

Redis 集群节点一般几十 GB 内存，AOF 恢复可能需要几十秒甚至几分钟，**影响重启速度**。

### ❌ 原因 2：主从同步使用 RDB

Redis Cluster 结构：

- 主节点写入 AOF
    
- **同步从节点还是用 RDB 快照**
    

所以就算你不开 RDB，主从同步还是会触发 RDB。
# 📌 为什么不能只用 RDB？

因为 RDB 默认间隔式触发（如 5min/15min），如果在两次 RDB 之间宕机：

👉 **会丢失最近 N 分钟数据。**

例如：

`save 900 1  // 15分钟一次 save 300 10 // 5分钟一次 save 60 10000`

❗ 对业务数据要求较高的系统不能接受。
# 📌 最优方案是？

## ✔ **Redis 6.0+ 默认模式：AOF + RDB 混合持久化**

优点：

- 恢复速度几乎等于 RDB
    
- 数据丢失风险几乎等于 AOF
    
- AOF 文件大小更小（RDB 在前，日志在后）
    
- 写入性能也接近 RDB
    

完全是 RDB 和 AOF 的折中方案。

# 📌 面试最佳回答（强烈推荐背诵）

> 在 Redis 集群架构中，推荐开启 AOF + RDB 混合持久化。  
> 原因一是 Redis Cluster 的主从同步依赖 RDB，所以 RDB 不能关；  
> 原因二是 AOF 数据更安全，能减少数据丢失；  
> 原因三是 Redis6.0 的混合模式恢复速度快、文件更小、性能更好，是目前生产最佳实践。  
> 单纯使用 AOF 恢复速度太慢，而只用 RDB 数据容易丢失，因此通常使用混合模式。

