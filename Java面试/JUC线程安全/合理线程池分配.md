# ✅ **线程池如何合理分配？（标准面试回答）**

线程池大小的合理分配，本质是根据任务类型、硬件资源、业务特征和吞吐目标来做“容量规划”。核心点就是一句话：

> **CPU 密集型要让 CPU 打满；IO 密集型要让 CPU 等不到 IO。**

# 1️⃣ **先区分任务类型**

线程池大小配置完全取决于任务类型：

### ✔ **CPU 密集型（如加密、压缩、计算）**

- CPU 消耗占比高，几乎无 IO 阻塞  
    **线程数 = CPU 核心数 + 1**
    

理由：

- CPU 密集型的瓶颈是 CPU，本来就 100% 竞争
    
- 多一个线程可以应对线程切换/偶发停顿
    

例如：8 核 CPU → `corePoolSize = 9`
### ✔ **IO 密集型（数据库、网络、文件 IO）**

- 有大量等待，CPU 空闲时间多  
    **线程数 = CPU 核心数 × (1 / (1 - 阻塞系数))**
    

阻塞系数一般：

- 常规 Web 服务：0.8 ～ 0.9
    
- DB / Redis 请求频繁系统：0.9+
    

你也可以记一个简单的经验值：  
**线程数 ≈ CPU 核心数 × 2 ～ 4 倍**

例如：8 核 CPU → 推荐 `16～32` 条线程

### ✔ **混合型任务（既有 CPU 又有 IO）**

按比值分拆不同线程池  
比如：

- CPU 计算一直占 40%
    
- IO 占 60%
    

可以：

- 一个 CPU 线程池
    
- 一个 IO 线程池
    
- 或者 ForkJoin
# 2️⃣ **线程池参数如何配置？（面试官爱问）**

### **① corePoolSize（核心线程数）**

按任务类型决定：

- CPU 密集：= CPU 数 +1
    
- IO 密集：= CPU 数 × 2～4
    

### **② maximumPoolSize（最大线程数）**

- 短时间峰值到来时增加处理能力
    
- 一般为 corePoolSize 的 2～4 倍
    

或

- CPU 密集：core = max
    
- IO 密集：max = core × 2
    

### **③ queueCapacity（队列长度）**

取决于业务：

- **高实时性系统（行情、订单撮合）**：队列要小  
    避免堆积 → 线程爆满 → 延迟上涨
    
- **普通 Web**：队列 1000、2000 都可以
    
- **秒杀**：使用拒绝策略保护系统
    

经验值：  
`队列长度 = TPS × 可接受延迟（秒）`

例如：  
TPS 500，最大可等待 2 秒 → 队列需要 1000

