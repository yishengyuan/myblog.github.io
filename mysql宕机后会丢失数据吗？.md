# ✅ **一、MySQL 宕机后会不会丢数据？**

**答案：可能会，也可能不会，取决于几个关键配置。**

MySQL 是否丢数据主要受以下因素影响：

---

## **① InnoDB 引擎（默认）本身就是崩溃恢复安全的**

InnoDB 具备 **WAL 写前日志（redo log）+ 双写缓冲（doublewrite buffer）**，即使宕机重启，也会：

- 根据 redo log **把未落盘的数据重做**
    
- 根据 undo log **回滚未提交事务**
    

👉 **已提交的事务一般不会丢，只要 redo log 写成功了。**

---

## **② 但 MySQL 仍可能丢数据的三个场景**

### **场景 A：使用 `innodb_flush_log_at_trx_commit=2` 或 0**

这个参数决定 “提交事务时是否立刻刷盘”。

|值|说明|宕机风险|
|---|---|---|
|**1**（最安全）|每次提交都立刻 fsync 落盘|**几乎不丢**|
|**2**|写到 OS 缓存，不 fsync|**OS 崩溃会丢 1 秒**|
|**0**|1 秒刷盘一次|**系统宕机会丢 1 秒数据**|

很多公司为了性能会设置成 **2 或 0**，这才会带来 “宕机丢数据”。

---

### **场景 B：binlog 不是 sync 写入**

`sync_binlog = 1` 才是强一致。  
如果是默认（MySQL 5.7/8.0 默认不是 1）：

👉 **binlog 仍可能丢 1 秒数据**  
会导致 binlog 和 redo 不一致。

---

### **场景 C：使用 MyISAM**

MyISAM 不支持事务、没有redo log：

👉 **宕机会直接损坏表 / 丢数据**

虽然现在基本没人用 MyISAM 了，但某些老系统可能还有。

---

# **总结：MySQL 是否丢数据取决于配置，不是绝对安全。**

---

# ✅ **二、为什么一些公司选择 PostgreSQL（psql）？**

面试官说他们用 PostgreSQL 很正常，因为 PostgreSQL 在稳定性和一致性方面比 MySQL 更强。

---

## ⭐ PostgreSQL 的优势（你可以这样回答）

### **① 更强的 WAL + 崩溃恢复**

PostgreSQL 的 WAL 是强制一致性，不像 MySQL 会因为配置不同而导致 “不刷盘”。

在 PostgreSQL 中：

- 数据写前必须写入 WAL
    
- WAL 刷盘策略更安全
    

👉 **强一致性更可靠，不容易丢数据。**

---

### **② SQL 标准支持更完整**

PG 支持更多复杂查询、事务类型、CTE、窗口函数等，天然比 MySQL 更适合复杂业务。

---

### **③ 类型系统强，可扩展性极高**

PostgreSQL 支持：

- JSONB（真正可索引的 JSON）
    
- Array、Hstore
    
- 自定义类型、自定义函数
    
- GIS 功能（PostGIS）
    

在 Web3、交易所、数据系统中非常常见。

---

### **④ 原生 MVCC 无锁读写**

MySQL 的 MVCC 是基于 undo log，存在 “回滚链变长导致查询变慢”。

PG 的 MVCC 基于 **多版本文件系统**，无锁读写特性更强。

---

### **⑤ 高可靠性，尤其是金融行业偏 PG**

大量交易系统、券商、银行使用 PostgreSQL（或其企业发行版如 Greenplum、EDB）。

👉 **交易所、Web3 场景更喜欢 PostgreSQL，因为一致性和事务更稳。**

---

# ⭐ 面试官为什么提 PostgreSQL？

你可以这样理解：

**他们想看看你是否知道不同数据库的一致性与崩溃恢复机制的差异。**

如果你回答得好，会显得你对数据库底层比较懂。

---

# 如果你是 CEX 撮合 / 金融交易背景，可以这样回答（非常加分）：

> “MySQL 崩溃是否丢数据取决于 redo log 和 binlog 的落盘策略，  
> 如果 `innodb_flush_log_at_trx_commit != 1` 或 `sync_binlog != 1`，  
> 宕机确实可能丢 1 秒数据。
> 
> PostgreSQL 则 WAL 一致性更强，更多场景强制落盘，对金融业务更稳，  
> 所以很多交易所、券商会选择 PostgreSQL。”