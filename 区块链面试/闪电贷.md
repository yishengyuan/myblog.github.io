![[Pasted image 20251121171401.png]]

1. 发起闪电贷合约调用
2. 调用swap借取token
3. 将代币发送给智能合约 允许调用自定义的协议操作
4. 偿还手续费
## 时间加权平均价格（TWAP）现货价格预言机
![[Pasted image 20251121174310.png]]


# ⭐ 面试可直接背诵版本

> 闪电贷利用 EVM 原子性。
> 
> 交易流程是：
> 
> 1. 用户调用 flashLoan
>     
> 2. 协议把钱转给你的合约
>     
> 3. 回调你的 executeOperation
>     
> 4. 你在回调内进行套利、清算、搬砖等逻辑
>     
> 5. 回调结束前必须归还本金 + 手续费
>     
> 6. 协议校验成功 → 交易提交
>     
> 7. 任意一步失败 → 整个交易回滚，无需承担损失（除 gas）
>     
> 
> 核心点是：**借钱 → 用钱 → 还钱，由一笔交易串联，完全不可拆分。**