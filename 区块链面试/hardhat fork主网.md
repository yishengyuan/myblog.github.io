# ✅ 1. Hardhat 的主网 fork 是什么？

简单说：

> **Hardhat 在本地启动一条“本地链”，但这条链的数据来自主网某个区块的真实状态。**

你可以把它理解成：

**把主网在某个区块的所有合约、余额、状态，复制到你本地运行的虚拟链里。**

不是复制整个链，而是按需读取主网状态并缓存，所以非常快。

并不是传统意义上的 “git fork 分支”；  
而是 **“把主网的状态镜像过来，作为你测试环境的初始状态”**。

# 🚀 2. 为什么要 fork 主网？

在区块链开发中，单纯的本地测试链 (Hardhat Network / Ganache) 有个问题：

🚫 本地没有真实的 ERC20 余额  
🚫 没有真实的 DeFi 池子  
🚫 没有真实的 oracle 价格  
🚫 没有主网的合约  
🚫 没法模拟各种复杂场景

所以：**主网级别的调试几乎没法在本地复现。**

于是 Hardhat 提出 **主网 fork** 来解决这些痛点。

# 🌟 3. 好处是什么？（关键点）

## **① 可以与真实主网合约交互**

比如你写一个套利机器人，需要跟 Uniswap、Aave、Curve 等交互。

主网 fork 允许你：

`const uniswap = await ethers.getContractAt(    "IUniswapV2Router02",    "主网上的 Uniswap 地址" );`

你本地就能调用真实主网的合约逻辑。

---

## **② 你可以给自己“铸造”任何主网 token**

例如你想测试某个脚本是否能套利，需要真实的 USDC、WETH…

在 fork 后你可以直接：

`await network.provider.request({   method: "hardhat_setBalance",   params: ["你的地址", "0x100000000..."], });`

你就拥有了：

你就拥有了：

✔ 主网 USDC  
✔ 主网 WETH  
✔ 主网各协议的真实资金池

**不用花一分钱！**

---

## **③ 可以真实模拟 DeFi 套利、清算、质押场景**

比如清算 Aave：

- 读取真实借款人头寸
    
- 真实利率
    
- 真实抵押物价格
    
- 真实池子数据
    

这是在本地测试链完全做不到的。

## **④ 验证升级前的合约是否会“炸掉”**

如果你要升级某个已上线的协议，风险非常大。

主网 fork 可以做到：

- 把主网你的合约拉来本地
    
- 使用真实数据做测试
    
- 推演升级后会发生什么
    

这比 testnet 更真实，因为：

✔ 真实数据  
✔ 真实流动性

✔ 真实状态

---

## **⑤ 做安全测试非常有用**

主网 fork 让你可以：

- 模拟攻击场景
    
- 复现历史攻击
    
- fuzz 爆破主网 pool 的行为
    
- 模拟极端时刻（高 gas，资金耗尽等）
    

这对 Web3 安全工程师非常重要。

## **⑥ 效率极高，不需要 sync 整条链**

Hardhat 是：

> 需要哪个合约，就从主网 RPC “lazy load” 哪个合约。  
> 然后本地缓存。

不像 geth 那样需要同步整个链。

# 🧠 4. 用一句话总结

主网 fork = 本地模拟“真实主网”。

🥇 **比 testnet 更真实**  
🥇 **比主网上直接测试更安全、更便捷、更省钱**

是 Web3 高质量开发必不可少的功能。

# 🛠 5. 配置示例（超简洁）

`hardhat.config.js`：

`module.exports = {   networks: {     hardhat: {       forking: {         url: process.env.MAINNET_RPC,  // 主网 RPC         blockNumber: 19000000          // 固定区块（可选）       }     }   } }`


然后你在本地执行：

`npx hardhat console`

就能像在主网一样互动。

